package main

import (
	"batu/demo"
	"fmt"
	"git.apache.org/thrift.git/lib/go/thrift"
	"net"
	"os"
	//"strconv"
	"time"
)

const (
	HOST = "127.0.0.1"
	PORT = "9098"
)

func main() {
	startTime := currentTimeMillis()

	transportFactory := thrift.NewTFramedTransportFactory(thrift.NewTTransportFactory())
	protocolFactory := thrift.NewTBinaryProtocolFactoryDefault()

	transport, err := thrift.NewTSocket(net.JoinHostPort(HOST, PORT))
	if err != nil {
		fmt.Fprintln(os.Stderr, "error resolving address:", err)
		os.Exit(1)
	}

	useTransport := transportFactory.GetTransport(transport)
	client := demo.NewBatuThriftClientFactory(useTransport, protocolFactory)
	if err := transport.Open(); err != nil {
		fmt.Fprintln(os.Stderr, "Error opening socket to "+HOST+":"+PORT, " ", err)
		os.Exit(1)
	}
	defer transport.Close()
	paramMap := make(map[string]string)
	paramMap["path"] = "E:/gows/src/Thrift/server/272bb94d-1335-480b-be3c-81643a31a0e1-1499911449301.txt"
	paramMap["type"] = "path"
	paramMap["json"] = `[["电话","idfa","ema","银行内部","世界你好","自由自在"],["17782277993","","","1","2",""],["18055108397","","","1","3",""],["13392855539","","","1","4",""],["18927414041","","","1","5",""],["18166455656","","","1","6",""],["13359228840","","","1","7",""],["18122168581","","","1","8",""],["15364710990","","","1","9",""],["13302906338","","","1","10",""],["13302906338","","","1","11",""],["17729835585","","","1","12",""],["13385280050","","","1","13",""],["18092180167","","","1","14",""],["15397051735","","","1","15",""],["13343432089","","","1","16",""],["18149206100","","","1","17",""],["18051089967","","","1","18",""],["15325717241","","","1","19",""],["18007131543","","","1","20",""],["17761737679","","","1","21",""],["18938870368","","","1","22",""],["18072948085","","","1","23",""],["18902279322","","","1","24",""],["18011521286","","","1","25",""],["15388130519","","","1","26",""],["18092335801","","","1","27",""],["18938692080","","","1","28",""],["18100623968","","","1","29",""],["18162504215","","","1","30",""],["18982186270","","","1","31",""],["15389093213","","","1","32",""],["18925025088","","","1","33",""],["17752557636","","","1","34",""],["18024018524","","","1","35",""],["18980733252","","","1","36",""],["13324588576","","","1","37",""],["13380062514","","","1","38",""],["13380062514","","","1","39",""],["18080950817","","","1","40",""],["18903060721","","","1","41",""],["18903060721","","","1","42",""],["15353661190","","","1","43",""],["18080112966","","","1","44",""],["17791840945","","","1","45",""],["17791840945","","","1","46",""],["18086069180","","","1","47",""],["17725166759","","","1","48",""],["17708385118","","","1","49",""],["17720150490","","","1","50",""],["13310977223","","","1","51",""],["13388186315","","","1","52",""],["13373931817","","","1","53",""],["18907193669","","","1","54",""],["17712410842","","","1","55",""],["17723600266","","","1","56",""],["15397646317","","","1","57",""],["18995657668","","","1","58",""],["13389276130","","","1","59",""],["18086602768","","","1","60","自由自在"],["17783528569","","","1","61",""],["17784222842","","","1","62",""],["17784222842","","","1","63",""],["17721528435","","","1","64",""],["15527797792","","","1","65","自由自在"],["13316834758","","","1","66",""],["13316887913","","","1","67",""],["15378178676","","","1","68",""],["18926199823","","","1","69",""],["18106599198","","","1","70","自由自在"],["13368101072","","","1","71",""],["18958166977","","","1","72",""],["13316115200","","","1","73","自由自在"],["18981961715","","","","",""]]`

	r1, _ := client.CallBack(time.Now().Unix(), 2, paramMap)
	if r1 == "" {
	}

	fmt.Println(r1)
	endTime := currentTimeMillis()
	str := fmt.Sprintf("本次调用用时:%d-%d=%d毫秒\n", endTime, startTime, endTime-startTime)
	fmt.Println(str)

}

func currentTimeMillis() int64 {
	return time.Now().UnixNano() / 1000000
}
